from bs4 import BeautifulSoup
from src.Directory import Directory


class Vendor:
    def __init__(self, fileName):
        self.filename = fileName
        self.parser = None
        self.ratings = dict()


    def Parse(self):
        with open(self.filename) as inputFile:
            lines = "\n".join(inputFile.readlines())

        self.parser = BeautifulSoup(lines, "lxml")


    def FindRatings(self):
        children = self.parser.find_all(class_="container")
        if len(children) is 2:
            # Try to find this vendor's ratings
            ratingsTable = children[1].find(string="Ratings").parent.parent.parent.parent
            positive = ratingsTable.find(string="Positive").parent.parent
            self.ratings["positive"] = positive.find("b").string

            neutral = ratingsTable.find(string="Neutral").parent.parent
            self.ratings["neutral"] = neutral.find("b").string

            negative = ratingsTable.find(string="Negative").parent.parent
            self.ratings["negative"] = negative.find("b").string
        else:
            print("Parse error: Unable to extract ratings for this vendor.")


vendorDirectoryName = "/home/nsifniotis/PycharmProjects/zionshopusn6nopy.onion/scrapedData/vendor"

vendorDirectory = Directory(vendorDirectoryName)
vendorDirectory.Scan()

vendors = []
for vendorFile in vendorDirectory.Files():
    vendor = Vendor(vendorFile)
    vendor.Parse()
    vendor.FindRatings()
    vendors.append(vendor.parser)


solutionList = []
for vendor in vendors:
    children = vendor.find_all(class_="container")
    if len(children) is 2:
        print(children[1])

    else:
        print("Wrong length")

